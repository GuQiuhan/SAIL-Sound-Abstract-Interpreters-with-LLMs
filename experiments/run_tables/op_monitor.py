import os

import matplotlib.pyplot as plt

# 数据
ablation_data = {
    "A": {
        "Abs": [0.0],
        "Affine": [4.19, 3.07, 1.95, 0.0],
        "Avgpool": [9.28, 7.61, 6.45, 5.18, 3.44, 1.33, 0.52, 0.0],
        "HardSigmoid": [8.21, 7.83, 6.97, 6.01, 4.78, 3.02, 2.17, 1.63, 0.91, 0.0],
        "HardSwish": [7.54, 6.48, 5.81, 5.16, 4.74, 3.62, 2.73, 1.98, 1.04, 0.0],
        "HardTanh": [8.74, 7.21, 6.02, 5.27, 3.91, 2.88, 1.77, 1.09, 0.0],
        "Maxpool": [6.42, 5.67, 5.11, 4.52, 3.66, 2.94, 1.43, 0.67, 0.0],
        "Minpool": [7.23, 6.88, 5.77, 4.35, 3.91, 2.84, 2.11, 1.46, 0.0],
        "Neuron_add": [0.13, 0.0],
        "Neuron_max": [1.91, 1.02, 0.0],
        "Neuron_min": [2.37, 1.12, 0.0],
        "Neuron_mult": [7.91, 6.83, 5.22, 3.41, 2.47, 1.04, 0.0],
        "Relu": [0.27, 0.18, 0.04, 0.0],
        "Relu6": [8.91, 7.74, 6.27, 5.19, 3.67, 2.55, 1.38, 0.0],
    },
    "B": {
        "Abs": [2.7, 0.0],
        "Affine": [
            1.4,
            2.8,
            2.3,
            2.1,
            3.2,
            4.0,
            7.2,
            5.9,
            8.7,
            1.0,
            6.3,
            8.4,
            9.3,
            8.7,
            8.2,
            3.6,
            3.4,
            1.9,
            5.5,
            4.1,
        ],
        "Avgpool": [
            0.9,
            4.1,
            3.6,
            3.8,
            2.2,
            2.4,
            1.1,
            5.6,
            0.3,
            5.9,
            3.5,
            5.2,
            1.6,
            1.1,
            2.9,
            2.0,
            2.3,
            4.8,
            2.7,
            2.4,
        ],
        "HardSigmoid": [
            4.8,
            2.6,
            5.3,
            0.5,
            5.7,
            1.2,
            2.9,
            3.0,
            7.2,
            7.1,
            7.4,
            7.6,
            2.5,
            8.9,
            6.8,
            6.0,
            6.3,
            3.9,
            9.6,
            8.6,
        ],
        "HardSwish": [
            3.3,
            2.5,
            0.7,
            3.1,
            2.9,
            2.3,
            1.5,
            1.0,
            2.6,
            4.7,
            5.1,
            0.2,
            8.5,
            1.6,
            2.8,
            2.4,
            3.1,
            5.7,
            6.2,
            3.8,
        ],
        "HardTanh": [
            5.2,
            3.9,
            4.0,
            1.4,
            3.7,
            2.3,
            3.9,
            5.1,
            3.6,
            4.5,
            3.8,
            6.2,
            5.0,
            5.9,
            1.1,
            6.5,
            5.6,
            8.8,
            3.2,
            4.6,
        ],
        "Maxpool": [
            2.4,
            2.8,
            3.7,
            3.4,
            3.3,
            3.0,
            6.1,
            5.7,
            5.5,
            3.2,
            1.0,
            3.3,
            3.6,
            3.9,
            5.8,
            6.0,
            8.6,
            8.1,
            8.1,
            8.1,
        ],
        "Minpool": [
            1.0,
            0.9,
            0.7,
            2.5,
            3.6,
            5.1,
            5.4,
            6.3,
            4.9,
            5.7,
            5.3,
            5.2,
            4.0,
            8.1,
            5.7,
            7.4,
            6.6,
            6.0,
            3.9,
            5.0,
        ],
        "Neuron_add": [3.9, 4.3, 1.1, 1.6, 2.0, 5.8, 5.5, 4.4, 2.3, 3.7, 1.2, 0.2, 0.0],
        "Neuron_max": [5.4, 5.1, 5.9, 4.6, 3.2, 2.5, 2.0, 1.3, 0.8, 0.2],
        "Neuron_min": [4.3, 4.9, 3.6, 0.0],
        "Neuron_mult": [
            2.1,
            2.6,
            1.4,
            4.5,
            4.3,
            4.4,
            4.8,
            4.1,
            4.5,
            5.0,
            4.9,
            5.8,
            3.7,
            5.2,
            5.8,
            4.9,
            6.6,
            4.0,
            5.5,
            4.1,
        ],
        "Relu": [
            1.7,
            1.2,
            3.9,
            0.5,
            3.4,
            3.3,
            5.9,
            2.6,
            2.3,
            0.1,
            6.8,
            3.5,
            8.2,
            1.0,
            7.1,
            2.9,
            4.7,
            0.2,
            9.5,
            3.6,
        ],
        "Relu6": [4.4, 4.2, 3.7, 3.6, 3.3, 3.8, 3.6, 1.4, 4.8, 5.3, 4.5, 2.7, 2.1, 0.0],
    },
    "C": {
        "Abs": [0.0],
        "Affine": [
            8.94,
            8.94,
            6.21,
            8.94,
            2.89,
            8.66,
            8.94,
            3.81,
            7.14,
            1.52,
            3.81,
            3.66,
            2.84,
            5.91,
            4.53,
            3.38,
            6.27,
            9.12,
            5.19,
            3.91,
        ],
        "Avgpool": [
            6.79,
            6.79,
            6.79,
            6.79,
            6.79,
            2.16,
            6.79,
            6.79,
            8.22,
            6.79,
            4.61,
            6.79,
            9.82,
            6.79,
            6.79,
            7.67,
            6.79,
            4.76,
            1.33,
            8.59,
        ],
        "HardSwish": [
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            4.86,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
            7.41,
        ],
        "HardTanh": [
            5.62,
            3.38,
            9.13,
            2.74,
            7.81,
            1.86,
            8.22,
            4.99,
            2.47,
            6.01,
            9.62,
            5.36,
            1.97,
            7.59,
            2.84,
            3.11,
            6.18,
            2.48,
            8.92,
            1.04,
        ],
        "Maxpool": [
            4.94,
            9.08,
            1.29,
            6.91,
            2.11,
            7.74,
            4.68,
            2.33,
            8.29,
            1.76,
            5.73,
            7.44,
            3.12,
            2.69,
            6.86,
            1.34,
            5.19,
            3.73,
            8.01,
            2.18,
        ],
        "Minpool": [
            8.26,
            1.98,
            6.79,
            3.31,
            5.44,
            7.61,
            2.48,
            8.33,
            1.13,
            6.12,
            4.21,
            3.76,
            9.58,
            2.91,
            5.88,
            3.49,
            6.34,
            4.68,
            1.59,
            7.04,
        ],
        "Neuron_add": [2.18, 0.0],
        "Neuron_max": [
            4.17,
            4.17,
            4.17,
            4.17,
            4.17,
            6.39,
            4.17,
            4.17,
            1.23,
            4.58,
            4.17,
            4.17,
            4.17,
            4.17,
            4.17,
            4.17,
            6.96,
            4.17,
            5.41,
            4.17,
        ],
        "Neuron_min": [1.14, 0.0],
        "Neuron_mult": [
            8.42,
            6.14,
            6.14,
            6.14,
            6.14,
            6.14,
            6.14,
            1.77,
            8.61,
            2.02,
            6.33,
            3.19,
            7.48,
            5.81,
            2.74,
            4.22,
            8.03,
            3.89,
            1.98,
            6.14,
        ],
        "Relu": [
            5.21,
            3.42,
            7.11,
            2.36,
            6.44,
            4.73,
            8.21,
            1.84,
            5.61,
            3.77,
            6.08,
            2.49,
            4.22,
            6.94,
            2.63,
            8.18,
            3.09,
            1.72,
            7.84,
            2.16,
        ],
        "Relu6": [
            6.13,
            4.98,
            7.29,
            1.82,
            5.91,
            3.17,
            8.04,
            2.93,
            6.89,
            3.69,
            2.71,
            7.11,
            4.44,
            5.36,
            3.98,
            6.62,
            2.01,
            8.39,
            3.22,
            1.67,
        ],
    },
}

colors = [
    "#f8c471",
    "#f1a7a1",
    "#e67e22",
    "#d35400",
    "#e74c3c",
    "#2980b9",
    "#3498db",
    "#1abc9c",
    "#16a085",
    "#2c3e50",
    "#b94b76",
    "#f4c300",
]


def plot_ablation_scores(data_dict, title, filename):
    plt.figure(figsize=(10, 6))
    for idx, (op, scores) in enumerate(data_dict.items()):
        if not scores:
            continue
        color = colors[idx % len(colors)]
        plt.plot(range(len(scores)), scores, label=op, color=color, linewidth=2)

    plt.xlabel("Round", fontsize=12)
    plt.ylabel("Score", fontsize=12)
    plt.title(title, fontsize=14)
    plt.grid(True, linestyle="--", alpha=0.4)
    plt.legend(fontsize=9, loc="upper right", ncol=2)
    plt.tight_layout()

    plt.savefig(filename, dpi=300)
    plt.close()


plot_ablation_scores(
    ablation_data["A"],
    "Monitoring Transformer Soundness Across Rounds of Generation",
    "pics/op_monitor.png",
)
plot_ablation_scores(
    ablation_data["B"],
    "Monitoring Transformer Soundness Across Rounds of Generation",
    "pics/op_monitor_wo_cf.png",
)
plot_ablation_scores(
    ablation_data["C"],
    "Monitoring Transformer Soundness Across Rounds of Generation",
    "pics/op_monitor_wo_cex.png",
)
